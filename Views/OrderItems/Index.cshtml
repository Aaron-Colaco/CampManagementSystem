@model IEnumerable<WebApplication4.Models.OrderItem>

@{
    ViewData["Title"] = "My Cart";
    double orderCost = 0;
}
@if (TempData["SuccessMessage"] != null)
{
    <div class="toast-container position-fixed top-0 end-0 p-4" style="z-index: 1080; top: 80px; margin-top: 5%;">
        <div class="toast align-items-center border-0 show shadow-lg" role="alert" aria-live="assertive" aria-atomic="true" style="background-color: #e6f4ea; color: #4b5e6a; min-width: 300px; border-radius: 8px;">
            <div class="d-flex">
                <div class="toast-body py-3 px-4" style="font-size: 1rem; font-weight: 500;">
                    @TempData["SuccessMessage"]
                </div>
                <button type="button" class="btn-close me-3 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
        </div>
    </div>
}

<div class="container mt-5">
    <h2 class="text-center mb-4">Ordered Items by @ViewBag.Name</h2>

  

    <div class="table-responsive">
        <table class="table align-middle table-borderless shadow-sm">
            <thead class="border-bottom border-2">
                <tr class="text-muted small text-uppercase">
                    <th>Item</th>
                    <th class="text-center">Quantity</th>
                    <th class="text-center">Price</th>
                    <th class="text-center">Size</th>

                    <th class="text-center">Total</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var OrderItem in Model)
                {
                    double itemCost = OrderItem.Items.Price * OrderItem.Quantity;
                    orderCost += itemCost;

                    <tr class="border-bottom">
                        <td class="fw-semibold">@OrderItem.Items.Name</td>
                        <td class="text-center">@OrderItem.Quantity</td>
                        <td class="text-center text-muted">$@OrderItem.Items.Price.ToString("F2")</td>
                        <td class="text-center">@OrderItem.SizesReq</td>

                        <td class="text-center fw-bold text-success">$@itemCost.ToString("F2")</td>
                        <td class="text-center">
                            @if (OrderItem.Orders.StatusId == 1)
                            {
                                <form asp-action="Delete" method="post" style="display: inline;">
                                    <input type="hidden" name="itemId" value="@OrderItem.ItemId" />
                                    <button type="submit" title="Remove item" style="background: none; border: 1px solid red; color: red; padding: 2px 8px; font-size: 16px; cursor: pointer; border-radius: 4px;">
                                        ×
                                    </button>
                                </form>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <div class="text-center mt-3">
        <h4>Total Cost: <span class="text-primary fw-bold">$@orderCost.ToString("F2")</span></h4>
    </div>

    <div class="text-center mt-4">
        @{
            var firstOrderItem = Model.FirstOrDefault();

            if (firstOrderItem != null && !User.IsInRole("Admin"))
            { 
                if (firstOrderItem.Orders.StatusId == 1 && !User.IsInRole("Admin"))
                {
                    <a class="btn btn-lg btn-success px-5" asp-controller="OrderItems" asp-action="ProcessOrder" asp-route-id="@ViewBag.orderId">Checkout</a>
                }
                else
                {
               
                }
            }
           
        }
    </div>
</div>

@if (firstOrderItem.Orders.StatusId == 4)
{
    <style>
        .return-all-link:hover {
            background-color: #006666 !important;
            text-decoration: underline !important;
        }
    </style>

    <h5>Total Items in Hire: <strong>@ViewBag.T</strong></h5>
    <a href="#" class="badge text-white text-decoration-none return-all-link" style="background-color: teal; padding: 0.3rem 0.75rem; display: inline-block; border-radius: 0.25rem; text-decoration: underline;"  data-bs-toggle="modal"data-bs-target="#confirmModal"data-order-id="@firstOrderItem.OrderId">
        Return All
    </a>
}

<button type="button" onclick="window.history.back()" class="btn btn-link p-0"
        style="color: teal !important; font-weight: bold; font-size: 1rem; text-decoration: underline; display: block; margin-top: 0.5rem;">
    Go back
</button>

                    <style>
    body {
        font-family: 'Inter', sans-serif;
        background-color: #f9f9f9;
    }

    h1 {
        font-size: 2rem;
        font-weight: 600;
        letter-spacing: 0.5px;
    }


    .btn-outline-danger {
        border-radius: 50%;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .btn-outline-danger:hover {
        background-color: #e63946;
        color: #fff;
        border-color: #e63946;
    }

    .btn-success {
        background-color: #008080;
        border: none;
        transition: background-color 0.3s ease;
    }

    .btn-success:hover {
        background-color: #006666;
    }

    .text-primary {
        color: #008080 !important;
    }

</style>
