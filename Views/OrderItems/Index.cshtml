@model IEnumerable<WebApplication4.Models.OrderItem>

@{
    ViewData["Title"] = "My Cart";
    double orderCost = 0;
    var firstOrderItem = Model.FirstOrDefault();
}

<div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">



                <h5 class="modal-title">Confirm Return</h5>



                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>This action can’t be undone. Are you sure you want to return all items?</p>
            </div>
            <div class="modal-footer">
                <form asp-controller="Orders" asp-action="UnassingAll">
                    <input type="hidden" name="id" value="@firstOrderItem.OrderId" />



                    <input type="hidden" name="SearchTerm" value="@ViewBag.SearchTerm" />



                    <input type="hidden" name="Status" value="@ViewBag.Status" />



                    <input type="hidden" name="page" value="@ViewBag.Page" />
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                    <button type="submit" class="btn btn-danger">Yes</button>
                </form>
            </div>
        </div>
    </div>
</div>


<div class="container mt-5">
    <h2 class="text-center mb-4">Ordered Items by @ViewBag.Name</h2>

  

    <div class="table-responsive">
        <table class="table align-middle table-borderless shadow-sm">
            <thead class="border-bottom border-2">
                <tr class="text-muted small text-uppercase">
                    <th>Item</th>
                    <th class="text-center">Quantity</th>
                    <th class="text-center">Price</th>
                    <th class="text-center">Size</th>

                    <th class="text-center">Total</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var OrderItem in Model)
                {
                    double itemCost = OrderItem.Items.Price * OrderItem.Quantity;
                    orderCost += itemCost;

                    <tr class="border-bottom">
                        <td class="fw-semibold">@OrderItem.Items.Name</td>
                        <td class="text-center">@OrderItem.Quantity</td>
                        <td class="text-center text-muted">$@OrderItem.Items.Price.ToString("F2")</td>
                        <td class="text-center">@OrderItem.SizesReq</td>

                        <td class="text-center fw-bold text-success">$@itemCost.ToString("F2")</td>
                        <td class="text-center">
                            @if (OrderItem.Orders.StatusId == 1)
                            {
                                <form asp-action="Delete" method="post" style="display: inline;">
                                    <input type="hidden" name="itemId" value="@OrderItem.ItemId" />
                                    <button type="submit" title="Remove item" style="background: none; border: 1px solid red; color: red; padding: 2px 8px; font-size: 16px; cursor: pointer; border-radius: 4px;">
                                        ×
                                    </button>
                                </form>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <div class="text-center mt-3">
        <h4>Total Cost: <span class="text-primary fw-bold">$@orderCost.ToString("F2")</span></h4>
    </div>

    <div class="text-center mt-4">
        @{
           

            if (firstOrderItem != null && !User.IsInRole("Admin"))
            { 
                if (firstOrderItem.Orders.StatusId == 1 && !User.IsInRole("Admin"))
                {
                    <a class="btn btn-lg btn-success px-5" asp-controller="OrderItems" asp-action="ProcessOrder" asp-route-id="@ViewBag.orderId">Checkout</a>
                }
                else
                {
               
                }
            }
           
        }
    </div>
</div>

@if(firstOrderItem.Orders.StatusId == 4)
{

    <h5 style="text-align: center;">Gear hired: <span style="color: teal; font-weight: bold;">@ViewBag.H</span> &nbsp;|&nbsp; Items to return: <span style="color: teal; font-weight: bold;">@ViewBag.T</span></h5>
    <br />
    <div style="display: flex; align-items: center; gap: 10px; margin-left:auto; margin-right: auto;">
<a href="#" class="btn" style="background-color: #1b4d3e; color: #ffffff; font-weight: bold; padding: 10px 20px; border-radius: 8px; text-decoration: none; display: inline-block; font-size: 1.1rem; min-width: 150px; text-align: center;" data-bs-toggle="modal" data-bs-target="#confirmModal" data-order-id="@firstOrderItem.OrderId" aria-label="Return All Items">Return All</a>
<a class="btn" style="background-color: #333333; color: #ffffff; font-weight: bold; padding: 10px 20px; border-radius: 8px; text-decoration: none; display: inline-block; font-size: 1.1rem; min-width: 150px; text-align: center;" asp-controller="Stocks" asp-action="AS" asp-route-id="@firstOrderItem.OrderId" asp-route-SearchTerm="@ViewBag.SearchTerm" asp-route-Status="@ViewBag.Status" asp-route-page="@ViewBag.Page" aria-label="Show Items in Inventory">Show in Inventory</a>
<button type="button" onclick="window.history.back()" class="btn" style="background-color: #1b4d3e; color: #ffffff; font-weight: bold; padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer; display: inline-block; font-size: 1.1rem; min-width: 150px; text-align: center;" aria-label="Go Back">Go back</button>
</div> 

}
<style>
    .return-all-link:hover {
        background-color: #006666 !important;
        text-decoration: underline !important;
    }
</style>
                    <style>
    body {
        font-family: 'Inter', sans-serif;
        background-color: #f9f9f9;
    }

    h1 {
        font-size: 2rem;
        font-weight: 600;
        letter-spacing: 0.5px;
    }


    .btn-outline-danger {
        border-radius: 50%;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .btn-outline-danger:hover {
        background-color: #e63946;
        color: #fff;
        border-color: #e63946;
    }

    .btn-success {
        background-color: #008080;
        border: none;
        transition: background-color 0.3s ease;
    }

    .btn-success:hover {
        background-color: #006666;
    }

    .text-primary {
        color: #008080 !important;
    }

</style>
